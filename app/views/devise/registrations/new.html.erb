<script type="text/javascript">
  
  $(function() {
    $("#nav").css("background-image", 'none');
  });

  $(function() {
    $("input[type='file").change(function(evt) {
      var images = evt.target.files;
      for(var i=0, f; f=images[i]; i++) {
        if(!f.type.match('image.*')) {
          continue;
        }
        var reader = new FileReader();
        reader.onload = (function(file) {
          return function(e) {
            $(".user-img img").attr("src", e.target.result);
          }
        })(f);
        reader.readAsDataURL(f);
      }
    });


     // jquery validate
    $("#new_user").validate({
        rules: {
            "user[name]": {
                required: true
            },
            "user[motto]": {
                required: false
            },
            "user[email]": {
                required: true
            },
            "user[password]": {
              required: true,
              minlength: 3
            },
            "user[sex]": {
              required: true
            },
            "user[occupation]": {
              required:true
            },
            "user[photo]": {
              required: true
            }
        },

        highlight: function(element) {
            $(element).closest(".form-group").addClass('has-error');
        },
        unhighlight: function(element) {
            $(element).closest('.form-group').removeClass('has-error');
        },

        errorElement: 'span',
        errorClass: 'help-block',
        errorPlacement: function(error, element) {
            if(element.parent('.input-group').length) {
                error.appendTo(element.parent());
            } else {
                error.appendTo(element.parent());
            }
        },
/*        submitHandler: function(form) {
            jQuery(form).ajaxSubmit(options);
            $("#pre").hide();
            $("#uploading").show();
            $("#myModal").modal('hide');
        }*/
    });

  })

</script>

<style type="text/css">

  input[type='submit'] {
    height: 40px
  }

  input[type='file'] {
    width:150px;
    height:30px;
    border:solid transparent;
    position:absolute;
    left:0px;
    top:10px;
    opacity:0;
    filter:alpha(opacity=0);
    cursor:pointer
  }

  .input-group {
    display: -webkit-box
  }

  .input-group span {
    margin-left: 15px
  }

  .form-group button {
    height: 40px;
    margin-left: 10px
  }

  .r-box {
    width: 100%
  }

  .buynow {
    width:80px; 
    font-size:12px;
    position:absolute;
    left:50px;
  }

</style>

<body id="top">
  <div class="contents">
    <%= render "home/nav3" %>
      <div style="height:76px">
      </div>
      <div class="container">
        <div style="height:50px">
        </div>
          <div class="r-box">
            <!-- <form action=""> -->
            <%= form_for(resource, :as => resource_name, :url => registration_path(resource_name)) do |f| %>
            <%= devise_error_messages! %>

                <div class="user-img">
                  <img src="/assets/question_mark.jpg" width="200px" class="img-rounded" /> 
                  <div class="form-group" style="text-align:center;position:relative;">
                    <button type="button" class="btn default btn-mini buynow">
                      <%= t('devise.links.upload_photo') %>
                    </button>
                    <div class="input-group">
                      <%= f.file_field :photo %>
                    </div>
                  </div>

                </div>
                <div class="form-con">

                  <div class="form-group">
                  <%= f.label :email do %> <%= User.human_attribute_name('email') %>: <% end %>
                  <div class="input-group">
                    <%= f.email_field :email, :autofocus => true %>
                  </div>  
                </div><br />

                  <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
                    <div class="form-group">Currently waiting confirmation for: <%= resource.unconfirmed_email %></div><br />
                  <% end %>

                  <div class="form-group"><%= f.label :password do %><%= User.human_attribute_name('password') %>: <% end %>
                    <div class="input-group">
                      <%= f.password_field :password, :autocomplete => "off" %>
                  </div>
                 </div>

                  <!-- <i>
                    (leave blank if you don't want to change it)
                  </i> -->

                  <div class="form-group"><%= f.label :password_confirmation do %>确认密码:<% end %>
                   <div class="input-group">
                      <%= f.password_field :password_confirmation %>
                  </div>
                 </div>

                  <div class="form-group">
                      <%= f.label :name do %><%= User.human_attribute_name('name') %>: <% end %>
                      <div class="input-group">
                      <%= f.text_field :name %>
                    </div>
                  </div>
   
                  <div class="form-group">
                      <%= f.label :sex do %><%= User.human_attribute_name('sex') %>: <% end %>
                      <div class="input-group">
                      <%= f.select(:sex, [['女', 'female'], ['男','male']]) %>
                    </div>
                  </div>

                  <div class="form-group">
                      <%= f.label :motto do %><%= User.human_attribute_name('motto') %>: <% end %>
                     <div class="input-group"> 
                      <%= f.text_area :motto %>
                    </div>
                  </div>

                  <div class="form-group">
                    <%= f.label :occupation_id do %><%= User.human_attribute_name('occupation') %>: <% end %>
                    <!-- f.select(:occupation_id, [['学生',1],['作者',2],['画家',3],['白领',4]]) -->
                    <div class="input-group"> 
                    <%= f.select(:occupation_id, Occupation.all.collect{|o|[o.name, o.id]}, {include_blank: true}) %>
                  </div>
                  </div>

                    <p>
                      <%= User.human_attribute_name('tag') %>:
                    </p>
                    <div class="label-box" style="padding-top:0; position:relative; top:-10px;">
                      <% @user.tags.each do |tag| %>
                           <a class="btn btn-success btn-mini" style="background-color:<%= tag.color.rgb %>; border:none transparent">
                          <%= tag.tag_name %>
                          </a>
                       <% end %>  
                    </div>

                    <fieldset>
                      <legend> <%= t('order.contact') %> </legend>
                      <div class="form-group">
                        <%= f.label :phone do %> <%= User.human_attribute_name('phone') %>: <% end %>
                        <div class="input-group"> 
                        <%= f.text_field :phone %>
                      </div>
                      </div>

                      <div class="form-group">
                        <%= f.label :address do %> <%= User.human_attribute_name('address') %>: <% end %>
                        <div class="input-group">
                        <%= f.text_area :address %>
                      </div>
                      </div>
                    </fieldset>

                  <!-- 使用Option Tags from a Collection of Arbitrary Objects来自动生成options -->

                    <div class="form-group">
                      <%= button_tag t('devise.links.reset'), type: :reset, class: "btn btn-warning btn-lg" %>
                      <%= f.submit t('devise.links.sign_up_btn'), class: "btn btn-success btn-lg", style: "margin-left: 20px" %>
                    </div>

                  <% end %><!-- </form> -->
            </div><!--form-con end-->
          </div><!-- r-box -->
      </div><!-- container -->
    </div> <!-- contents -->
</body>