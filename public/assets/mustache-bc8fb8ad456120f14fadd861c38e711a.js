!function(t,e){if("object"==typeof exports&&exports)e(exports);else{var n={};e(n),"function"==typeof define&&define.amd?define(n):t.Mustache=n}}(this,function(t){function e(t,e){return d.call(t,e)}function n(t){return!e(v,t)}function r(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t){return String(t).replace(/[&<>"'\/]/g,function(t){return x[t]})}function o(t){this.string=t,this.tail=t,this.pos=0}function a(t,e){this.view=t||{},this.parent=e,this._cache={}}function s(){this.clearCache()}function c(e,n,r,i){for(var o,a,s,l="",p=0,u=e.length;u>p;++p)switch(o=e[p],a=o[1],o[0]){case"#":if(s=r.lookup(a),"object"==typeof s)if(b(s))for(var h=0,f=s.length;f>h;++h)l+=c(o[4],n,r.push(s[h]),i);else s&&(l+=c(o[4],n,r.push(s),i));else if("function"==typeof s){var g=null==i?null:i.slice(o[3],o[5]);s=s.call(r.view,g,function(t){return n.render(t,r)}),null!=s&&(l+=s)}else s&&(l+=c(o[4],n,r,i));break;case"^":s=r.lookup(a),(!s||b(s)&&0===s.length)&&(l+=c(o[4],n,r,i));break;case">":s=n.getPartial(a),"function"==typeof s&&(l+=s(r));break;case"&":s=r.lookup(a),null!=s&&(l+=s);break;case"name":s=r.lookup(a),null!=s&&(l+=t.escape(s));break;case"text":l+=a}return l}function l(t){for(var e,n=[],r=n,i=[],o=0,a=t.length;a>o;++o)switch(e=t[o],e[0]){case"#":case"^":i.push(e),r.push(e),r=e[4]=[];break;case"/":var s=i.pop();s[5]=e[2],r=i.length>0?i[i.length-1][4]:n;break;default:r.push(e)}return n}function p(t){for(var e,n,r=[],i=0,o=t.length;o>i;++i)e=t[i],e&&("text"===e[0]&&n&&"text"===n[0]?(n[1]+=e[1],n[3]=e[3]):(n=e,r.push(e)));return r}function u(t){return[new RegExp(r(t[0])+"\\s*"),new RegExp("\\s*"+r(t[1]))]}function h(e,i){function a(){if(E&&!P)for(;U.length;)delete _[U.pop()];else U=[];E=!1,P=!1}if(e=e||"",i=i||t.tags,"string"==typeof i&&(i=i.split(g)),2!==i.length)throw new Error("Invalid tags: "+i.join(", "));for(var s,c,h,v,d,k=u(i),b=new o(e),x=[],_=[],U=[],E=!1,P=!1;!b.eos();){if(s=b.pos,h=b.scanUntil(k[0]))for(var C=0,j=h.length;j>C;++C)v=h.charAt(C),n(v)?U.push(_.length):P=!0,_.push(["text",v,s,s+1]),s+=1,"\n"==v&&a();if(!b.scan(k[0]))break;if(E=!0,c=b.scan(y)||"name",b.scan(f),"="===c?(h=b.scanUntil(w),b.scan(w),b.scanUntil(k[1])):"{"===c?(h=b.scanUntil(new RegExp("\\s*"+r("}"+i[1]))),b.scan(m),b.scanUntil(k[1]),c="&"):h=b.scanUntil(k[1]),!b.scan(k[1]))throw new Error("Unclosed tag at "+b.pos);if(d=[c,h,s,b.pos],_.push(d),"#"===c||"^"===c)x.push(d);else if("/"===c){if(0===x.length)throw new Error('Unopened section "'+h+'" at '+s);var A=x.pop();if(A[1]!==h)throw new Error('Unclosed section "'+A[1]+'" at '+s)}else if("name"===c||"{"===c||"&"===c)P=!0;else if("="===c){if(i=h.split(g),2!==i.length)throw new Error("Invalid tags at "+s+": "+i.join(", "));k=u(i)}}var A=x.pop();if(A)throw new Error('Unclosed section "'+A[1]+'" at '+b.pos);return _=p(_),l(_)}var f=/\s*/,g=/\s+/,v=/\S/,w=/\s*=/,m=/\s*\}/,y=/#|\^|\/|>|\{|&|=|!/,d=RegExp.prototype.test,k=Object.prototype.toString,b=Array.isArray||function(t){return"[object Array]"===k.call(t)},x={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};o.prototype.eos=function(){return""===this.tail},o.prototype.scan=function(t){var e=this.tail.match(t);return e&&0===e.index?(this.tail=this.tail.substring(e[0].length),this.pos+=e[0].length,e[0]):""},o.prototype.scanUntil=function(t){var e,n=this.tail.search(t);switch(n){case-1:e=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:e="";break;default:e=this.tail.substring(0,n),this.tail=this.tail.substring(n),this.pos+=n}return e},a.make=function(t){return t instanceof a?t:new a(t)},a.prototype.push=function(t){return new a(t,this)},a.prototype.lookup=function(t){var e=this._cache[t];if(!e){if("."==t)e=this.view;else for(var n=this;n;){if(t.indexOf(".")>0){e=n.view;for(var r=t.split("."),i=0;e&&i<r.length;)e=e[r[i++]]}else e=n.view[t];if(null!=e)break;n=n.parent}this._cache[t]=e}return"function"==typeof e&&(e=e.call(this.view)),e},s.prototype.clearCache=function(){this._cache={},this._partialCache={}},s.prototype.compile=function(e,n){var r=this._cache[e];if(!r){var i=t.parse(e,n);r=this._cache[e]=this.compileTokens(i,e)}return r},s.prototype.compilePartial=function(t,e,n){var r=this.compile(e,n);return this._partialCache[t]=r,r},s.prototype.getPartial=function(t){return t in this._partialCache||!this._loadPartial||this.compilePartial(t,this._loadPartial(t)),this._partialCache[t]},s.prototype.compileTokens=function(t,e){var n=this;return function(r,i){if(i)if("function"==typeof i)n._loadPartial=i;else for(var o in i)n.compilePartial(o,i[o]);return c(t,n,a.make(r),e)}},s.prototype.render=function(t,e,n){return this.compile(t)(e,n)},t.name="mustache.js",t.version="0.7.2",t.tags=["{{","}}"],t.Scanner=o,t.Context=a,t.Writer=s,t.parse=h,t.escape=i;var _=new s;t.clearCache=function(){return _.clearCache()},t.compile=function(t,e){return _.compile(t,e)},t.compilePartial=function(t,e,n){return _.compilePartial(t,e,n)},t.compileTokens=function(t,e){return _.compileTokens(t,e)},t.render=function(t,e,n){return _.render(t,e,n)},t.to_html=function(e,n,r,i){var o=t.render(e,n,r);return"function"!=typeof i?o:(i(o),void 0)}});