function BuyUrl(){var e=$("input[id^=qty_item_]").val(),t=/^[0-9]{1,4}$/;t.exec(e)?(0>=e&&(e=1),e>=1e3&&(e=999)):e=1}function recalc(){$("input[id^=total_item]").val(),$("[id^=total_item]").calc("qty * price",{qty:$("input[name^=qty_item_]"),price:$("[id^=price_item_]")},function(e){return"￥"+e.toFixed(2)},function(e){var t=e.sum();$("[id^=total_item]").text("￥"+t.toFixed(2)),$("#total_price").val($("[id^=total_item]").text())}),$("[id^=total_points]").calc("qty * price",{qty:$("input[name^=qty_item_]"),price:$("[id^=price_item_]")},function(e){return""+e.toFixed(0)})}!function($){var defaults={reNumbers:/(-|-\$)?(\d+(,\d{3})*(\.\d{1,})?|\.\d{1,})/g,cleanseNumber:function(e){return e.replace(/[^0-9.\-]/g,"")},useFieldPlugin:!!$.fn.getValue,onParseError:null,onParseClear:null};$.Calculation={version:"0.4.07",setDefaults:function(e){$.extend(defaults,e)}},$.fn.parseNumber=function(e){var t=[];return e=$.extend(e,defaults),this.each(function(){var r=$(this),a=r.is(":input")?defaults.useFieldPlugin?"getValue":"val":"text",n=$.trim(r[a]()).match(defaults.reNumbers,"");null==n?(n=0,jQuery.isFunction(e.onParseError)&&e.onParseError.apply(r,[a]),$.data(r[0],"calcParseError",!0)):(n=e.cleanseNumber.apply(this,[n[0]]),$.data(r[0],"calcParseError")&&jQuery.isFunction(e.onParseClear)&&(e.onParseClear.apply(r,[a]),$.data(r[0],"calcParseError",!1))),t.push(parseFloat(n,10))}),t},$.fn.calc=function(expr,vars,cbFormat,cbDone){var $this=this,exprValue="",precision=0,$el,parsedVars={},tmp,sMethod,_,bIsError=!1;for(var k in vars)expr=expr.replace(new RegExp("("+k+")","g"),"_.$1"),parsedVars[k]=vars[k]&&vars[k].jquery?vars[k].parseNumber():vars[k];return this.each(function(i,el){var p,len;$el=$(this),sMethod=$el.is(":input")?defaults.useFieldPlugin?"setValue":"val":"text",_={};for(var k in parsedVars)"number"==typeof parsedVars[k]?_[k]=parsedVars[k]:"string"==typeof parsedVars[k]?_[k]=parseFloat(parsedVars[k],10):parsedVars[k]&&parsedVars[k]instanceof Array&&(tmp=parsedVars[k].length==$this.length?i:0,_[k]=parsedVars[k][tmp]),isNaN(_[k])&&(_[k]=0),p=_[k].toString().match(/\.\d+$/gi),len=p?p[0].length-1:0,len>precision&&(precision=len);try{if(exprValue=eval(expr),precision&&(exprValue=Number(exprValue.toFixed(Math.max(precision,4)))),jQuery.isFunction(cbFormat)){var tmp=cbFormat.apply(this,[exprValue]);tmp&&(exprValue=tmp)}}catch(e){exprValue=e,bIsError=!0}$el[sMethod](exprValue.toString())}),jQuery.isFunction(cbDone)&&cbDone.apply(this,[this]),this},$.each(["sum","avg","min","max"],function(e,t){$.fn[t]=function(e,r){if(0==arguments.length)return math[t](this.parseNumber());var a=r&&r.constructor==Object&&!(r instanceof jQuery),n=e&&e.constructor==Object?e:{bind:e||"keyup",selector:a?null:r,oncalc:null};a&&(n=jQuery.extend(n,r)),n.selector&&(n.selector=$(n.selector));var i,s=this,u=function(){var e=math[t](s.parseNumber(n));n.selector&&(i=n.selector.is(":input")?defaults.useFieldPlugin?"setValue":"val":"text",n.selector[i](e.toString())),jQuery.isFunction(n.oncalc)&&n.oncalc.apply(s,[e,n])};return u(),s.bind(n.bind,u)}});var math={sum:function(e){var t=0,r=0;return $.each(e,function(e,a){var n=a.toString().match(/\.\d+$/gi),i=n?n[0].length-1:0;i>r&&(r=i),t+=a}),r&&(t=Number(t.toFixed(r))),t},avg:function(e){return math.sum(e)/e.length},min:function(e){return Math.min.apply(Math,e)},max:function(e){return Math.max.apply(Math,e)}}}(jQuery);var setAmount={min:1,max:999,reg:function(e){return new RegExp("^[1-9]\\d*$").test(e)},amount:function(e,t){var r=$(e).val();return this.reg(r)?t?r++:r--:(alert("请输入正确的数量！"),$(e).val(1),$(e).focus()),r},reduce:function(e){var t=this.amount(e,!1);t>=this.min?($(e).val(t).change(),recalc()):(alert("商品数量最少为"+this.min),$(e).val(1).change(),$(e).focus())},add:function(e){var t=this.amount(e,!0);t<=this.max?($(e).val(t).change(),recalc()):(alert("商品数量最多为"+this.max),$(e).val(999).change(),$(e).focus())},modify:function(e){var t=$(e).val();(t<this.min||t>this.max||!this.reg(t))&&(alert("请输入正确的数量！"),$(e).val(1),$(e).focus())}};$(document).ready(function(){$("input[name^=qty_item_]").bind("keyup",recalc),recalc()});